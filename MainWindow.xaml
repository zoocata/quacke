<Window x:Class="QuakeServerManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quake III Server Manager" Height="800" Width="1200"
        MinHeight="700" MinWidth="1000"
        WindowStartupLocation="CenterScreen">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*" MinHeight="200"/> <!-- Main Content -->
            <RowDefinition Height="5"/> <!-- GridSplitter -->
            <RowDefinition Height="120" MinHeight="50" MaxHeight="400"/> <!-- Terminal -->
            <RowDefinition Height="Auto"/> <!-- Status Bar -->
            <RowDefinition Height="Auto"/> <!-- Master Control -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2D2D30" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Quake III Server Manager" 
                               FontSize="24" FontWeight="Bold" 
                               Foreground="White" VerticalAlignment="Center"/>
                    <TextBlock Text="v1.0" Margin="10,0,0,0" 
                               FontSize="12" Foreground="#CCCCCC" 
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <Button Grid.Column="1" Content="Settings" Click="Settings_Click"
                        Background="Transparent" Foreground="White" 
                        BorderThickness="1" BorderBrush="#666"
                        Padding="12,6" FontWeight="SemiBold" Height="30"/>
            </Grid>
        </Border>
        
        <!-- Deployment Warning Banner -->
        <Border Grid.Row="0" Background="#DC3545" Padding="15,8" 
                Visibility="{Binding IsDeploying, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="⚠️" FontSize="20" 
                           Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0"/>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="DEPLOYMENT IN PROGRESS" 
                               FontSize="14" FontWeight="Bold" 
                               Foreground="White"/>
                    <TextBlock Text="Do not close the application or you may corrupt the server installation!" 
                               FontSize="11" Foreground="#FFE6E6" 
                               TextWrapping="Wrap"/>
                </StackPanel>
                
                <TextBlock Grid.Column="2" Text="⚠️" FontSize="20" 
                           Foreground="White" VerticalAlignment="Center" Margin="10,0,0,0"/>
            </Grid>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Left Column -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Scrollable Content -->
                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                        <!-- VPS Connections -->
                        <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" 
                                CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="VPS Connections" 
                                           FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                                
                                                                                                             <ListBox Grid.Row="1" x:Name="VpsConnectionsListBox" 
                                          ItemsSource="{Binding VpsConnections}"
                                          SelectedItem="{Binding SelectedVpsConnection}"
                                          Margin="0,0,0,10" Height="150"
                                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                                          MouseDoubleClick="VpsConnectionsListBox_MouseDoubleClick">
                                     <ListBox.ItemTemplate>
                                         <DataTemplate>
                                             <Grid>
                                                 <StackPanel x:Name="DisplayPanel" Orientation="Horizontal" Visibility="Visible">
                                                     <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                                     <TextBlock Text=" - " Foreground="#666"/>
                                                     <TextBlock Text="{Binding Ip}" Foreground="#666"/>
                                                 </StackPanel>
                                                 <TextBox x:Name="EditTextBox" 
                                                          Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                          Visibility="Collapsed"
                                                          FontWeight="SemiBold"
                                                          LostFocus="EditTextBox_LostFocus"
                                                          KeyDown="EditTextBox_KeyDown"/>
                                             </Grid>
                                         </DataTemplate>
                                     </ListBox.ItemTemplate>
                                 </ListBox>
                                
                                                                 <StackPanel Grid.Row="2" Orientation="Horizontal">
                                     <Button Content="Add VPS" Command="{Binding AddVpsCommand}" 
                                             Background="#007ACC" Foreground="White" Margin="0,0,8,0"
                                             Padding="12,6" FontWeight="SemiBold" Height="30"/>
                                     <Button Content="Delete" Command="{Binding DeleteVpsCommand}" 
                                             Background="#DC3545" Foreground="White"
                                             Padding="12,6" FontWeight="SemiBold" Height="30"/>
                                 </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Connection Settings -->
                        <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" 
                                CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="Connection Settings" 
                                           FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>
                                
                                <!-- Connection Details -->
                                <StackPanel Grid.Row="1" Margin="0,0,0,15">
                                    <Label Content="IP Address:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedVpsConnection.Ip, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3" Height="30"
                                             VerticalContentAlignment="Center" FontSize="12"
                                             IsEnabled="{Binding SelectedVpsConnection, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="0.0.0.0" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="Port:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedVpsConnection.Port, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3" Height="30"
                                             VerticalContentAlignment="Center" FontSize="12"
                                             IsEnabled="False"
                                             Background="#F5F5F5">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="22" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="Username:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedVpsConnection.Username, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3" Height="30"
                                             VerticalContentAlignment="Center" FontSize="12"
                                             IsEnabled="False"
                                             Background="#F5F5F5">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="root" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="SSH Password:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <PasswordBox x:Name="PasswordBox" 
                                                 PasswordChar="●" MaxLength="50"
                                                 Margin="0,0,0,10" Padding="5,3" Height="30"
                                                 VerticalContentAlignment="Center" FontSize="12"/>
                                </StackPanel>
                                
                                <!-- Private Key Path -->
                                <StackPanel Grid.Row="2" Margin="0,0,0,15">
                                    <Label Content="Private Key Path:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVpsConnection.PrivateKeyPath, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,5,0" Padding="5,3" Height="30"
                                                 VerticalContentAlignment="Center" FontSize="12">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="Private Key Path (optional)" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="12" 
                                                                                       Margin="5,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        <Button Grid.Column="1" Content="Browse" Command="{Binding BrowseKeyCommand}" 
                                                Margin="5,0,0,0" Height="30"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- Fixed Test & Save Connection Button -->
                <Border Grid.Row="1" Background="#F8F9FA" BorderBrush="#DEE2E6" 
                        BorderThickness="1" CornerRadius="5" Padding="15" Margin="0,10,0,0">
                    <Button Content="Test &amp; Save Connection" Command="{Binding TestConnectionCommand}" 
                            Background="#28A745" Foreground="White"
                            Padding="12,6" FontWeight="SemiBold" Height="30"
                            HorizontalAlignment="Stretch"/>
                </Border>
            </Grid>
            
            <!-- Separator -->
            <Border Grid.Column="1" Background="#DDDDDD" Width="5"/>
            
            <!-- Middle Panel - Server Configuration -->
            <Border Grid.Column="2" Background="#F5F5F5" CornerRadius="5" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="Server Configuration" 
                               FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <ComboBox x:Name="InstancesComboBox" 
                                  ItemsSource="{Binding ServerInstances}"
                                  SelectedItem="{Binding SelectedServerInstance}"
                                  Width="200" Margin="0,0,10,0"
                                  Height="30" Padding="5,3"
                                  VerticalContentAlignment="Center"
                                  FontSize="12">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                        <TextBlock Text=" - " Foreground="#666"/>
                                        <TextBlock Text="{Binding DeploymentStatusDisplay}" 
                                                   Foreground="{Binding IsDeployed, Converter={StaticResource BoolToColorConverter}}"
                                                   FontSize="10"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <Button Content="Add Instance" Command="{Binding AddInstanceCommand}" 
                                Background="#007ACC" Foreground="White" Margin="0,0,8,0"
                                Padding="12,6" FontWeight="SemiBold" Height="30"/>
                        <Button Content="Delete Instance" Command="{Binding DeleteInstanceCommand}" 
                                Background="#DC3545" Foreground="White"
                                Padding="12,6" FontWeight="SemiBold" Height="30"/>
                    </StackPanel>
                    
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Basic Settings (Collapsible) -->
                            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15">
                                <Expander Header="Basic Settings" IsExpanded="True">
                                    <Expander.Style>
                                        <Style TargetType="Expander">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="HeaderTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="⚙️" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                            <TextBlock Text="{Binding}" FontWeight="Bold" FontSize="14" Foreground="#495057" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Expander.Style>
                                <GroupBox BorderThickness="0" Padding="10">
                                <StackPanel Margin="10">
                                    <CheckBox Content="Retain initial values" 
                                              IsChecked="{Binding RetainInitialValues, UpdateSourceTrigger=PropertyChanged}"
                                              IsEnabled="{Binding CanRetainInitialValues}"
                                              Margin="0,0,0,15" FontSize="12" FontWeight="SemiBold"
                                              ToolTip="Copy values from the first instance to new instances (except Server Name)"/>
                                    
                                    <Label Content="Server Name:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedServerInstance.ServerName, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3"
                                             VerticalContentAlignment="Center"
                                             FontSize="12"
                                             IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Server Name" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                    <Trigger Property="Text" Value="{x:Null}">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Server Name" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="Admin:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedServerInstance.Admin, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3"
                                             VerticalContentAlignment="Center"
                                             FontSize="12"
                                             IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Admin" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                    <Trigger Property="Text" Value="{x:Null}">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Admin" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="Location:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedServerInstance.Location, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3"
                                             VerticalContentAlignment="Center"
                                             FontSize="12"
                                             IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Location" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                    <Trigger Property="Text" Value="{x:Null}">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Location" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="RCON Password:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <PasswordBox x:Name="RconPasswordBox"
                                                 Margin="0,0,0,10" Padding="5,3"
                                                 VerticalContentAlignment="Center"
                                                 FontSize="12"
                                                 IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}"/>
                                     
                                    <Label Content="Max Clients:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedServerInstance.MaxClients, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3"
                                             VerticalContentAlignment="Center"
                                             FontSize="12"
                                             IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Max Clients" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Label Content="Server Port:" FontWeight="SemiBold" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding SelectedServerInstance.Port, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0,0,0,10" Padding="5,3"
                                             VerticalContentAlignment="Center"
                                             FontSize="12"
                                             IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Style.Triggers>
                                                    <Trigger Property="Text" Value="">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Port" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                </StackPanel>
                                </GroupBox>
                                </Expander>
                            </Border>
                            
                            <!-- Class Settings Section (Collapsible) -->
                            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15">
                                <Expander Header="Class Settings" IsExpanded="False">
                                    <Expander.Style>
                                        <Style TargetType="Expander">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="HeaderTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="🏳️" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                            <TextBlock Text="{Binding}" FontWeight="Bold" FontSize="14" Foreground="#495057" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Expander.Style>
                                <GroupBox BorderThickness="0" Padding="10">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Configure the class for this server instance (see https://playmorepromode.com/guides/cpma-ntf-configs)" 
                                               TextWrapping="Wrap" Margin="0,0,0,10" Foreground="#666" FontSize="11"/>
                                    
                                    <Label Content="Class Name (n):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Class name (e.g., Scout, Fighter, Tank, Sniper)"/>
                                    <ComboBox ItemsSource="{Binding AvailableClasses}"
                                              SelectedItem="{Binding SelectedServerInstance.SelectedClass, UpdateSourceTrigger=PropertyChanged}"
                                              DisplayMemberPath="Name"
                                              Margin="0,0,0,10" Padding="5,3"
                                              VerticalContentAlignment="Center"
                                              FontSize="12"
                                              IsEnabled="{Binding SelectedServerInstance, Converter={StaticResource NotNullToBoolConverter}}">
                                        <ComboBox.Style>
                                            <Style TargetType="ComboBox">
                                                <Style.Triggers>
                                                    <Trigger Property="SelectedItem" Value="{x:Null}">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                    <VisualBrush.Visual>
                                                                        <TextBlock Text="Select Class" 
                                                                                   Foreground="Gray" 
                                                                                   FontSize="12" 
                                                                                   Margin="5,0,0,0"/>
                                                                    </VisualBrush.Visual>
                                                                </VisualBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ComboBox.Style>
                                    </ComboBox>
                                    
                                    <TextBlock Text="{Binding SelectedServerInstance.SelectedClass.Description}" 
                                               Foreground="#666" FontSize="11" 
                                               TextWrapping="Wrap" Margin="0,0,0,10"
                                               Visibility="{Binding SelectedServerInstance.SelectedClass, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                    
                                    <!-- Class Configuration Panel -->
                                    <StackPanel Visibility="{Binding SelectedServerInstance.SelectedClass, Converter={StaticResource NotNullToVisibilityConverter}}">
                                        <TextBlock Text="Class Configuration:" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,5"/>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Left Column -->
                                            <StackPanel Grid.Column="0">
                                                <Label Content="Model (m):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Player model (e.g., slash, sarge)"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Model, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Base Speed (s):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Movement speed (e.g., 320)"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.BaseSpeed, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Spawn Health (h):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Health at spawn"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.SpawnHealth, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Maximum Armour (a):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Max armor"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.MaxArmour, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Armour Class (ac):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="0=Green, 1=Yellow, 2=Red"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.ArmourClass, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <!-- Right Column -->
                                            <StackPanel Grid.Column="2">
                                                <Label Content="Hook Type (ht):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="0=None, 1=Offhand, 2=Onhand"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.HookType, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Hook Pull (hp):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Grapple pull speed"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.HookPull, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <Label Content="Hook Speed (hs):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Grapple hook speed"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.HookSpeed, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                                <CheckBox Content="Double Jump (jd)" IsChecked="{Binding SelectedServerInstance.SelectedClass.DoubleJump, UpdateSourceTrigger=PropertyChanged}"
                                                          Margin="0,0,0,8" FontSize="11" ToolTip="Can double-jump"/>
                                                <CheckBox Content="Ramp Jump (jr)" IsChecked="{Binding SelectedServerInstance.SelectedClass.RampJump, UpdateSourceTrigger=PropertyChanged}"
                                                          Margin="0,0,0,8" FontSize="11" ToolTip="Can ramp-jump"/>
                                                <Label Content="Starting Weapon (sw):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Weapon number (from wX lines, or 1 for gauntlet)"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.StartingWeapon, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                        </Grid>
                                        <!-- Weapons Row -->
                                        <Grid Margin="0,5,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <Label Content="Machine Gun (w2):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w2: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon2, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <Label Content="Shotgun (w3):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w3: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon3, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="4">
                                                <Label Content="Machine Gun (w4):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w4: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon4, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="6">
                                                <Label Content="Grenade Launcher (w5):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w5: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon5, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                        </Grid>
                                        <Grid Margin="0,5,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <Label Content="Rocket Launcher (w6):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w6: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon6, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <Label Content="Lightning Gun (w7):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w7: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon7, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="4">
                                                <Label Content="Plasma Gun (w8):" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="w8: spawn,max,box,gun"/>
                                                <TextBox Text="{Binding SelectedServerInstance.SelectedClass.Weapon8, UpdateSourceTrigger=PropertyChanged}"
                                                         Margin="0,0,0,8" Padding="3" FontSize="11"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>
                                </StackPanel>
                                </GroupBox>
                            </Expander>
                            </Border>
                            
                            <!-- Advanced Settings Section (Collapsible) -->
                            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15">
                                <Expander Header="Advanced Settings" IsExpanded="False">
                                    <Expander.Style>
                                        <Style TargetType="Expander">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="HeaderTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="🔧" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                            <TextBlock Text="{Binding}" FontWeight="Bold" FontSize="14" Foreground="#495057" VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Expander.Style>
                                <GroupBox BorderThickness="0" Padding="10">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Configure advanced server settings that will be included in the server configuration file" 
                                               TextWrapping="Wrap" Margin="0,0,0,10" Foreground="#666" FontSize="11"/>
                                    
                                    <!-- Advanced Settings Single Column -->
                                    <StackPanel>
                                        <Label Content="Pure Server:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Enable pure server mode"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_pure], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="1" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Snapshots:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Number of snapshots per second"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[snaps], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="30" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Strict Auth:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Enable strict authentication"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_strictAuth], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Server Record:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Enable server recording"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_record], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Chat Flood Protect:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Enable chat flood protection"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_chatfloodprotect], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Max Rate:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Maximum client rate"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_maxrate], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="30000" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Allow Download:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Allow client downloads"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_allowDownload], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Gameplay:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Gameplay type"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_gameplay], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="CPM" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Max Packets Min:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Minimum max packets"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_maxpacketsmin], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="100" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Max Packets Max:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Maximum max packets"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_maxpacketsmax], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="125" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Rate Min:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Minimum client rate"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_ratemin], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="25000" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Optimize BW:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Optimize bandwidth"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[server_optimisebw], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="1" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Log Per Game:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Log per game"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[log_pergame], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Match Ready Percent:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Match ready percentage"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[match_readypercent], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="100" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Private Clients:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Number of private clients"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_privateClients], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="0" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Private Password:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Private server password"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_privatePassword], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="(empty)" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                        
                                        <Label Content="Restart Delay:" FontWeight="SemiBold" Margin="0,0,0,2" ToolTip="Server restart delay"/>
                                        <TextBox Text="{Binding SelectedServerInstance.AdvancedSettings[sv_restartDelay], UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,0,0,8" Padding="3" FontSize="11">
                                            <TextBox.Style>
                                                <Style TargetType="TextBox">
                                                    <Style.Triggers>
                                                        <Trigger Property="Text" Value="">
                                                            <Setter Property="Background">
                                                                <Setter.Value>
                                                                    <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                                        <VisualBrush.Visual>
                                                                            <TextBlock Text="2" 
                                                                                       Foreground="Gray" 
                                                                                       FontSize="11" 
                                                                                       Margin="3,0,0,0"/>
                                                                        </VisualBrush.Visual>
                                                                    </VisualBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBox.Style>
                                        </TextBox>
                                    </StackPanel>
                                </StackPanel>
                                </GroupBox>
                            </Expander>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
            
            <!-- Separator -->
            <Border Grid.Column="3" Background="#DDDDDD" Width="5"/>
            
            <!-- Right Panel - Server Operations -->
            <Border Grid.Column="4" Background="#F5F5F5" CornerRadius="5" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="Server Operations" 
                               FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Deployment Section -->
                            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15">
                                <GroupBox Header="Deployment" Margin="0,0,0,15">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Deploy selected server instance - uploads server files and dependencies to VPS" 
                                               TextWrapping="Wrap" Margin="0,0,0,10" Foreground="#666" FontSize="11"/>
                                    
                                                                         <Button Content="Deploy Server" Command="{Binding DeployServerCommand}" 
                                             Padding="15,8" FontWeight="SemiBold" Height="40"
                                             FontSize="14" Margin="0,0,0,10">
                                         <Button.Style>
                                             <Style TargetType="Button">
                                                 <Style.Triggers>
                                                     <DataTrigger Binding="{Binding IsQ3PathValid}" Value="False">
                                                         <Setter Property="Background" Value="#DC3545"/>
                                                         <Setter Property="Foreground" Value="White"/>
                                                         <Setter Property="Content" Value="Set Q3 Installation Path"/>
                                                     </DataTrigger>
                                                     <DataTrigger Binding="{Binding IsQ3PathValid}" Value="True">
                                                         <Setter Property="Background" Value="#28A745"/>
                                                         <Setter Property="Foreground" Value="White"/>
                                                         <Setter Property="Content" Value="Deploy Server"/>
                                                     </DataTrigger>
                                                 </Style.Triggers>
                                             </Style>
                                         </Button.Style>
                                     </Button>
                                     
                                     <!-- Progress Bar -->

                                    
                                    <TextBlock Text="{Binding Q3ValidationMessage}" 
                                               Foreground="#666" FontSize="11" HorizontalAlignment="Center"
                                               TextWrapping="Wrap" Margin="0,0,0,5"/>
                                    
                                    <TextBlock x:Name="DeploymentStatus" Text="Ready to deploy" 
                                               Foreground="#666" FontSize="11" HorizontalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsQ3PathValid}" Value="False">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsQ3PathValid}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    
                                    <!-- Deployment State Info -->
                                    <Border Background="#E9ECEF" BorderBrush="#DEE2E6" BorderThickness="1" 
                                            CornerRadius="3" Padding="8,5" Margin="0,10,0,0">
                                        <StackPanel>
                                            <TextBlock Text="Deployment State" FontWeight="SemiBold" FontSize="11" Margin="0,0,0,3"/>
                                            <TextBlock Text="{Binding CurrentDeploymentState.DeployedInstances.Count, StringFormat='Deployed Instances: {}{0}'}" 
                                                       FontSize="10" Foreground="#666"/>
                                            <TextBlock Text="{Binding CurrentDeploymentState.LastDeploymentSync, StringFormat='Last Sync: {}{0:g}'}" 
                                                       FontSize="10" Foreground="#666" 
                                                       Visibility="{Binding CurrentDeploymentState.LastDeploymentSync, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </Border>
                                    

                                    
                                    <!-- Import Existing Configurations Button -->
                                    <Button Content="Import Existing Configurations" Command="{Binding ImportExistingConfigurationsCommand}" 
                                            Background="#17A2B8" Foreground="White"
                                            Padding="10,6" FontWeight="SemiBold" Height="30" Margin="0,5,0,0"
                                            IsEnabled="{Binding ImportExistingConfigurationsCommand.CanExecute}"
                                            ToolTip="Import existing server configurations from the VPS server">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CurrentDeploymentState.HasDeployedInstances}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                                </GroupBox>
                            </Border>
                            
                            <!-- Server Management Section -->
                            <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="5" Margin="0,0,0,15">
                                <GroupBox Header="Server Management" Margin="0,0,0,15">
                                <StackPanel Margin="10">
                                    <TextBlock Text="Daily server operations - start, stop, and manage running servers" 
                                               TextWrapping="Wrap" Margin="0,0,0,10" Foreground="#666" FontSize="11"/>
                                    
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="5"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="5"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <Button Grid.Column="0" Content="Start" Command="{Binding StartServerCommand}" 
                                                Background="#007ACC" Foreground="White"
                                                Padding="8,6" FontWeight="SemiBold" Height="30"
                                                IsEnabled="{Binding StartServerCommand.CanExecute}"/>
                                        <Button Grid.Column="2" Content="Stop" Command="{Binding StopServerCommand}" 
                                                Background="#DC3545" Foreground="White"
                                                Padding="8,6" FontWeight="SemiBold" Height="30"
                                                IsEnabled="{Binding StopServerCommand.CanExecute}"/>
                                        <Button Grid.Column="4" Content="Restart" Command="{Binding RestartServerCommand}" 
                                                Background="#FFC107" Foreground="Black"
                                                Padding="8,6" FontWeight="SemiBold" Height="30"
                                                IsEnabled="{Binding RestartServerCommand.CanExecute}"/>
                                    </Grid>
                                    
                                    <TextBlock x:Name="ServerStatus" Text="Server status: Unknown" 
                                               Foreground="#666" FontSize="11" HorizontalAlignment="Center"/>
                                </StackPanel>
                                </GroupBox>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
        
        <!-- GridSplitter for Terminal -->
        <GridSplitter Grid.Row="2" x:Name="TerminalSplitter" HorizontalAlignment="Stretch" 
                      Background="#DDDDDD" Height="5" 
                      VerticalAlignment="Stretch" ResizeDirection="Rows" ShowsPreview="True"/>
        
        <!-- Terminal Output -->
        <Border Grid.Row="3" Background="#1E1E1E" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Terminal Header -->
                <Border Grid.Row="0" Background="#2D2D30" Padding="5,2" 
                        MouseLeftButtonDown="TerminalHeader_MouseDoubleClick">
                    <TextBlock Text="Terminal Output" 
                               FontSize="12" FontWeight="Bold" 
                               Foreground="White" VerticalAlignment="Center"/>
                </Border>
                
                <!-- Terminal Content -->
                <ScrollViewer Grid.Row="1" x:Name="TerminalScrollViewer"
                             VerticalScrollBarVisibility="Auto" 
                             HorizontalScrollBarVisibility="Disabled"
                             Margin="5,0,5,5">
                    <TextBox x:Name="TerminalOutput" 
                             Background="Transparent" 
                             Foreground="#00FF00" 
                             FontFamily="Consolas" 
                             FontSize="10"
                             IsReadOnly="True"
                             Text="{Binding TerminalOutput, UpdateSourceTrigger=PropertyChanged}"
                             VerticalAlignment="Stretch"
                             HorizontalAlignment="Stretch"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             AcceptsTab="True"
                             VerticalScrollBarVisibility="Auto"/>
                </ScrollViewer>
            </Grid>
        </Border>
        
        <!-- Status Bar with Progress -->
        <Border Grid.Row="4" Background="#2D2D30" Padding="10,5"
                Visibility="{Binding IsDeploying, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <ProgressBar Value="{Binding DeploymentProgress}" 
                                Maximum="100" Height="6" 
                                Background="#1E1E1E" Foreground="#007ACC"
                                HorizontalAlignment="Stretch"/>
                    <TextBlock Text="{Binding DeploymentStatus}" 
                               Foreground="White" FontSize="10" 
                               HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </StackPanel>
                
                <Button Grid.Column="1" Content="Cancel Deployment" 
                        Background="#DC3545" Foreground="White"
                        BorderThickness="1" BorderBrush="#B02A37"
                        Padding="12,6" FontWeight="SemiBold" Height="30"
                        Margin="10,0,0,0" Click="CancelDeployment_Click"/>
            </Grid>
        </Border>
        
        <!-- Master Control -->
        <Border Grid.Row="5" Background="#1E1E1E" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Sync Maps Button -->
                <Button Grid.Column="0" Content="Sync Maps" Command="{Binding SyncMapsCommand}"
                        Background="#007ACC" Foreground="White" 
                        Padding="15,8" FontWeight="SemiBold" Height="35"
                        Margin="0,0,15,0"
                        IsEnabled="{Binding IsDeploying, Converter={StaticResource BoolInverterConverter}}"/>
                
                <!-- Cycle Servers Dropdown -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="CycleServersButton" Content="Cycle Servers" 
                            Background="#FFC107" Foreground="Black"
                            Padding="15,8" FontWeight="SemiBold" Height="35"
                            Margin="0,0,5,0" Click="CycleServersButton_Click"
                            IsEnabled="{Binding IsDeploying, Converter={StaticResource BoolInverterConverter}}"/>
                    <Button Content="▼" Background="#FFC107" Foreground="Black"
                            Padding="5,8" FontWeight="SemiBold" Height="35"
                            Click="CycleServersDropdown_Click"
                            IsEnabled="{Binding IsDeploying, Converter={StaticResource BoolInverterConverter}}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window> 